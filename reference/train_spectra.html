<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Train a model based predict reference values with spectral data — train_spectra • waves</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train a model based predict reference values with spectral data — train_spectra"><meta name="description" content="Trains spectral prediction models using one of several
algorithms and sampling procedures."><meta property="og:description" content="Trains spectral prediction models using one of several
algorithms and sampling procedures."><meta property="og:image" content="https://GoreLab.github.io/waves/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">waves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/waves.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GoreLab/waves/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Train a model based predict reference values with spectral data</h1>
      <small class="dont-index">Source: <a href="https://github.com/GoreLab/waves/blob/main/R/train_spectra.R" class="external-link"><code>R/train_spectra.R</code></a></small>
      <div class="d-none name"><code>train_spectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Trains spectral prediction models using one of several
algorithms and sampling procedures.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">train_spectra</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">num.iterations</span>,</span>
<span>  test.data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k.folds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  proportion.train <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  tune.length <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  model.method <span class="op">=</span> <span class="st">"pls"</span>,</span>
<span>  best.model.metric <span class="op">=</span> <span class="st">"RMSE"</span>,</span>
<span>  stratified.sampling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cv.scheme <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trial1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trial2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trial3 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  split.test <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  save.model <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rf.variable.importance <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output.summary <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  return.model <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p><code>data.frame</code> object. First column contains unique identifiers,
second contains reference values, followed by spectral columns. Include no
other columns to right of spectra! Column names of spectra must start with
"X" and reference column must be named "reference"</p></dd>


<dt id="arg-num-iterations">num.iterations<a class="anchor" aria-label="anchor" href="#arg-num-iterations"></a></dt>
<dd><p>Number of training iterations to perform</p></dd>


<dt id="arg-test-data">test.data<a class="anchor" aria-label="anchor" href="#arg-test-data"></a></dt>
<dd><p><code>data.frame</code> with same specifications as <code>df</code>. Use
if specific test set is desired for hyperparameter tuning. If <code>NULL</code>,
function will automatically train with a stratified sample of 70%. Default
is <code>NULL</code>.</p></dd>


<dt id="arg-k-folds">k.folds<a class="anchor" aria-label="anchor" href="#arg-k-folds"></a></dt>
<dd><p>Number indicating the number of folds for k-fold
cross-validation during model training. Default is 5.</p></dd>


<dt id="arg-proportion-train">proportion.train<a class="anchor" aria-label="anchor" href="#arg-proportion-train"></a></dt>
<dd><p>Fraction of samples to include in the training set.
Default is 0.7.</p></dd>


<dt id="arg-tune-length">tune.length<a class="anchor" aria-label="anchor" href="#arg-tune-length"></a></dt>
<dd><p>Number delineating search space for tuning of the PLSR
hyperparameter <code>ncomp</code>. Must be set to 5 when using the random forest
algorithm (<code>model.method == rf</code>). Default is 50.</p></dd>


<dt id="arg-model-method">model.method<a class="anchor" aria-label="anchor" href="#arg-model-method"></a></dt>
<dd><p>Model type to use for training. Valid options include:</p><ul><li><p>"pls": Partial least squares regression (Default)</p></li>
<li><p>"rf": Random forest</p></li>
<li><p>"svmLinear": Support vector machine with linear
kernel</p></li>
<li><p>"svmRadial": Support vector machine with radial kernel</p></li>
</ul></dd>


<dt id="arg-best-model-metric">best.model.metric<a class="anchor" aria-label="anchor" href="#arg-best-model-metric"></a></dt>
<dd><p>Metric used to decide which model is best. Must be
either "RMSE" or "Rsquared"</p></dd>


<dt id="arg-stratified-sampling">stratified.sampling<a class="anchor" aria-label="anchor" href="#arg-stratified-sampling"></a></dt>
<dd><p>If <code>TRUE</code>, training and test sets will be
selected using stratified random sampling. This term is only used if
<code>test.data == NULL</code>. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-cv-scheme">cv.scheme<a class="anchor" aria-label="anchor" href="#arg-cv-scheme"></a></dt>
<dd><p>A cross validation (CV) scheme from Jarquín et al., 2017.
Options for <code>cv.scheme</code> include:</p><ul><li><p>"CV1": untested lines in tested environments</p></li>
<li><p>"CV2": tested lines in tested environments</p></li>
<li><p>"CV0": tested lines in untested environments</p></li>
<li><p>"CV00": untested lines in untested environments</p></li>
</ul></dd>


<dt id="arg-trial-">trial1<a class="anchor" aria-label="anchor" href="#arg-trial-"></a></dt>
<dd><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. Contains the trial to be tested in subsequent
model training functions. The first column contains unique identifiers,
second contains genotypes, third contains reference values, followed by
spectral columns. Include no other columns to right of spectra! Column
names of spectra must start with "X", reference column must be named
"reference", and genotype column must be named "genotype".</p></dd>


<dt id="arg-trial-">trial2<a class="anchor" aria-label="anchor" href="#arg-trial-"></a></dt>
<dd><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. This data.frame contains a trial that has
overlapping genotypes with <code>trial1</code> but that were grown in a different
site/year (different environment). Formatting must be consistent with
<code>trial1</code>.</p></dd>


<dt id="arg-trial-">trial3<a class="anchor" aria-label="anchor" href="#arg-trial-"></a></dt>
<dd><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. This data.frame contains a trial that may or
may not contain genotypes that overlap with <code>trial1</code>. Formatting must
be consistent with <code>trial1</code>.</p></dd>


<dt id="arg-split-test">split.test<a class="anchor" aria-label="anchor" href="#arg-split-test"></a></dt>
<dd><p>boolean that allows for a fixed training set and a split
test set. Example// train model on data from two breeding programs and a
stratified subset (70%) of a third and test on the remaining samples
(30%)  of the third. If <code>FALSE</code>, the entire provided test set
<code>test.data</code> will remain as a testing set or if none is provided, 30%
of the provided <code>train.data</code> will be used for testing. Default is
<code>FALSE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer to be used internally as input for <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>.
Only used if <code>stratified.sampling = TRUE</code>. In all other cases, seed
is set to the current iteration number. Default is 1.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>If <code>TRUE</code>, the number of rows removed through filtering
will be printed to the console. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-save-model">save.model<a class="anchor" aria-label="anchor" href="#arg-save-model"></a></dt>
<dd><p>DEPRECATED <code>save.model = FALSE</code> is no
longer supported; this function will always return a saved model.</p></dd>


<dt id="arg-rf-variable-importance">rf.variable.importance<a class="anchor" aria-label="anchor" href="#arg-rf-variable-importance"></a></dt>
<dd><p>DEPRECATED
<code>rf.variable.importance = FALSE</code> is no longer supported; variable
importance results are always returned if the <code>model.method</code> is
set to `pls` or `rf`.</p></dd>


<dt id="arg-output-summary">output.summary<a class="anchor" aria-label="anchor" href="#arg-output-summary"></a></dt>
<dd><p>DEPRECATED <code>output.summary = FALSE</code>
is no longer supported; a summary of output is always returned alongside
the full performance statistics.</p></dd>


<dt id="arg-return-model">return.model<a class="anchor" aria-label="anchor" href="#arg-return-model"></a></dt>
<dd><p>DEPRECATED <code>return.model = FALSE</code>
is no longer supported; a trained model object is always returned
alongside the full performance statistics and summary.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>list of the following:</p><ol><li><p><code>model</code> is a model object trained with all rows of <code>df</code>.</p></li>
<li><p><code>summary.model.performance</code> is a <code>data.frame</code> with model
  performance statistics in summary format (2 rows, one with mean and one
  with standard deviation of all training iterations).</p></li>
<li><p><code>full.model.performance</code> is a <code>data.frame</code> with model
  performance statistics in long format
  (number of rows = <code>num.iterations</code>)</p></li>
<li><p><code>predictions</code> is a <code>data.frame</code> containing predicted values
  for each test set entry at each iteration of model training.</p></li>
<li><p><code>importance</code> is a <code>data.frame</code> that contains variable
  importance for each wavelength. Only available for <code>model.method</code>
  options "rf" and "pls".</p></li>
</ol><p>Included summary statistics:</p><ul><li><p>Tuned parameters depending on the model algorithm:</p><ul><li><p><strong>Best.n.comp</strong>, the best number of components</p></li>
<li><p><strong>Best.ntree</strong>, the best number of trees in an RF model</p></li>
<li><p><strong>Best.mtry</strong>, the best number of variables to include at
    every decision point in an RF model</p></li>
</ul></li>
<li><p><strong>RMSECV</strong>, the root mean squared error of cross-validation</p></li>
<li><p><strong>R2cv</strong>, the coefficient of multiple determination of
  cross-validation for PLSR models</p></li>
<li><p><strong>RMSEP</strong>, the root mean squared error of prediction</p></li>
<li><p><strong>R2p</strong>, the squared Pearson’s correlation between predicted and
  observed test set values</p></li>
<li><p><strong>RPD</strong>, the ratio of standard deviation of observed test set
  values to RMSEP</p></li>
<li><p><strong>RPIQ</strong>, the ratio of performance to interquartile difference</p></li>
<li><p><strong>CCC</strong>, the concordance correlation coefficient</p></li>
<li><p><strong>Bias</strong>, the average difference between the predicted and
  observed values</p></li>
<li><p><strong>SEP</strong>, the standard error of prediction</p></li>
<li><p><strong>R2sp</strong>, the squared Spearman’s rank correlation between
  predicted and observed test set values</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jenna Hershberger <a href="mailto:jmh579@cornell.edu">jmh579@cornell.edu</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ikeogu.2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study.name</span> <span class="op">==</span> <span class="st">"C16Mcal"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="va">DMC.oven</span>,</span></span>
<span class="r-in"><span>                unique.id <span class="op">=</span> <span class="va">sample.id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">unique.id</span>, <span class="va">reference</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">train_spectra</span><span class="op">(</span></span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>    tune.length <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    num.iterations <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    best.model.metric <span class="op">=</span> <span class="st">"RMSE"</span>,</span></span>
<span class="r-in"><span>    stratified.sampling <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Returning model...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           Length Class      Mode</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model                     20     mvr        list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> summary.model.performance 15     data.frame list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model.performance         15     data.frame list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predictions                5     data.frame list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> importance                 4     data.frame list</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://jmh579.github.io" class="external-link">Jenna Hershberger</a>, NSF BREAD IOS-1543958.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

