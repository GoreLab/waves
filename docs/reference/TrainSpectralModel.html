<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Train a model based predict reference values with spectral data — TrainSpectralModel • waves</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Train a model based predict reference values with spectral data — TrainSpectralModel" />
<meta property="og:description" content="Trains spectral prediction models using one of several algorithms and sampling
procedures.
Get the mode of a set of numbers. Used in getting summary of results
within [TrainSpectralModel()]" />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">waves</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/GoreLab/waves/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Train a model based predict reference values with spectral data</h1>
    <small class="dont-index">Source: <a href='https://github.com/GoreLab/waves/blob/master/R/TrainSpectralModel.R'><code>R/TrainSpectralModel.R</code></a></small>
    <div class="hidden name"><code>TrainSpectralModel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Trains spectral prediction models using one of several algorithms and sampling
procedures.</p>
<p>Get the mode of a set of numbers. Used in getting summary of results
within [TrainSpectralModel()]</p>
    </div>

    <pre class="usage"><span class='fu'>TrainSpectralModel</span><span class='op'>(</span>
  <span class='va'>df</span>,
  <span class='va'>num.iterations</span>,
  test.data <span class='op'>=</span> <span class='cn'>NULL</span>,
  tune.length <span class='op'>=</span> <span class='fl'>50</span>,
  model.method <span class='op'>=</span> <span class='st'>"pls"</span>,
  output.summary <span class='op'>=</span> <span class='cn'>TRUE</span>,
  return.model <span class='op'>=</span> <span class='cn'>FALSE</span>,
  best.model.metric <span class='op'>=</span> <span class='st'>"RMSE"</span>,
  rf.variable.importance <span class='op'>=</span> <span class='cn'>FALSE</span>,
  stratified.sampling <span class='op'>=</span> <span class='cn'>TRUE</span>,
  cv.scheme <span class='op'>=</span> <span class='cn'>NULL</span>,
  trial1 <span class='op'>=</span> <span class='cn'>NULL</span>,
  trial2 <span class='op'>=</span> <span class='cn'>NULL</span>,
  trial3 <span class='op'>=</span> <span class='cn'>NULL</span>,
  split.test <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p><code>data.frame</code> object. First column contains unique identifiers,
second contains reference values, followed by spectral columns. Include no
other columns to right of spectra! Column names of spectra must start with
"X" and reference column must be named "reference"</p></td>
    </tr>
    <tr>
      <th>num.iterations</th>
      <td><p>Number of training iterations to perform</p></td>
    </tr>
    <tr>
      <th>test.data</th>
      <td><p><code>data.frame</code> with same specifications as <code>df</code>. Use
if specific test set is desired for hyperparameter tuning. If <code>NULL</code>,
function will automatically train with a stratified sample of 70%. Default
is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>tune.length</th>
      <td><p>Number delineating search space for tuning of the PLSR
hyperparameter <code>ncomp</code>. Default is 50.</p></td>
    </tr>
    <tr>
      <th>model.method</th>
      <td><p>Model type to use for training. Valid options include:</p><ul>
<li><p>"pls": Partial least squares regression (Default)</p></li>
<li><p>"rf": Random forest</p></li>
<li><p>"svmLinear": Support vector machine with linear
kernel</p></li>
<li><p>"svmRadial": Support vector machine with radial kernel</p></li>
</ul></td>
    </tr>
    <tr>
      <th>output.summary</th>
      <td><p>boolean that controls function output.</p><ul>
<li><p>If <code>TRUE</code>, a summary df will be output (1st row = means, 2nd row =
standard deviations). Default is <code>TRUE</code>.</p></li>
<li><p>If <code>FALSE</code>, entire
results data frame will be output</p></li>
</ul></td>
    </tr>
    <tr>
      <th>return.model</th>
      <td><p>boolean that, if <code>TRUE</code>, causes the function to
return the trained model in addition to the results data frame.</p><ul>
<li><p>If <code>TRUE</code>, function return list of <code>[model, results]</code>.</p></li>
<li><p>If <code>FALSE</code>, returns results data frame without model. Default is
<code>FALSE</code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>best.model.metric</th>
      <td><p>Metric used to decide which model is best. Must be
either "RMSE" or "Rsquared"</p></td>
    </tr>
    <tr>
      <th>rf.variable.importance</th>
      <td><p>boolean that:</p><ul>
<li><p>If <code>TRUE</code>,
<code>model.method</code> must be set to "rf". Returns a list with a model
performance <code>data.frame</code> and a second <code>data.frame</code> with variable
importance values for each wavelength for each training iteration. If
<code>return.model</code> is also <code>TRUE</code>, returns list of three elements
with trained model first, model performance second, and variable importance
last. Dimensions are <code>nrow = num.iterations</code>, <code>ncol =
length(wavelengths)</code>.</p></li>
<li><p>If <code>FALSE</code>, no variable importance is
returned. Default is <code>FALSE</code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>stratified.sampling</th>
      <td><p>If <code>TRUE</code>, training and test sets will be
selected using stratified random sampling. This term is only used if
<code>test.data == NULL</code>. Default is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>cv.scheme</th>
      <td><p>A cross validation (CV) scheme from Jarquín et al., 2017.
Options for cv.scheme include:</p><ul>
<li><p>"CV1": untested lines in tested environments</p></li>
<li><p>"CV2": tested lines in tested environments</p></li>
<li><p>"CV0": tested lines in untested environments</p></li>
<li><p>"CV00": untested lines in untested environments</p></li>
</ul></td>
    </tr>
    <tr>
      <th>trial1</th>
      <td><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. Contains the trial to be tested in subsequent
model training functions. The first column contains unique identifiers,
second contains genotypes, third contains reference values, followed by
spectral columns. Include no other columns to right of spectra! Column
names of spectra must start with "X", reference column must be named
"reference", and genotype column must be named "genotype".</p></td>
    </tr>
    <tr>
      <th>trial2</th>
      <td><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. This data.frame contains a trial that has
overlapping genotypes with <code>trial1</code> but that were grown in a different
site/year (different environment). Formatting must be consistent with
<code>trial1</code>.</p></td>
    </tr>
    <tr>
      <th>trial3</th>
      <td><p><code>data.frame</code> object that is for use only when
<code>cv.scheme</code> is provided. This data.frame contains a trial that may or
may not contain genotypes that overlap with <code>trial1</code>. Formatting must
be consistent with <code>trial1</code>.</p></td>
    </tr>
    <tr>
      <th>split.test</th>
      <td><p>boolean that allows for a fixed training set and a split
test set. Example// train model on data from two breeding programs and a
stratified subset (70%) of a third and test on the remaining samples
(30%)  of the third. If <code>FALSE</code>, the entire provided test set
<code>test.data</code> will remain as a testing set or if none is provided, 30%
of the provided <code>train.data</code> will be used for testing. Default is
<code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>If <code>TRUE</code>, the number of rows removed through filtering
will be printed to the console. Default is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>vector.input</th>
      <td><p>The mode of this vector of numbers will be calculated by this function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>data.frame</code> with model performance statistics either in summary
  format (2 rows, one with mean and one with standard deviation of all
  training iterations) or in long format (number of rows =
  <code>num.iterations</code>). Also returns trained model if <code>return.model</code>
  is <code>TRUE</code>. If <code>FALSE</code>, returns results <code>data.frame</code> without
  model. Default is <code>FALSE</code>.
Included summary statistics:</p><ul>
<li><p>Tuned parameters depending on the model algorithm:</p><ul>
<li><p><strong>Best.n.comp</strong>, the best number of components</p></li>
<li><p><strong>Best.ntree</strong>, the best number of trees in an RF model</p></li>
<li><p><strong>Best.mtry</strong>, the best number of variables to include at every decision point in an RF model</p></li>
</ul></li>
<li><p><strong>RMSECV</strong>, the root mean squared error of cross-validation</p></li>
<li><p><strong>R2cv</strong>, the coefficient of multiple determination of cross-validation for PLSR models</p></li>
<li><p><strong>RMSEP</strong>, the root mean squared error of prediction</p></li>
<li><p><strong>R2p</strong>, the squared Pearson’s correlation between predicted and observed test set values</p></li>
<li><p><strong>RPD</strong>, the ratio of standard deviation of observed test set values to RMSEP</p></li>
<li><p><strong>RPIQ</strong>, the ratio of performance to interquartile difference</p></li>
<li><p><strong>CCC</strong>, the concordance correlation coefficient</p></li>
<li><p><strong>Bias</strong>, the average difference between the predicted and observed values</p></li>
<li><p><strong>SEP</strong>, the standard error of prediction</p></li>
<li><p><strong>R2sp</strong>, the squared Spearman’s rank correlation between predicted and observed test set values</p></li>
</ul>

<p>mode of the numbers in `vector.input`</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Jenna Hershberger <a href='mailto:jmh579@cornell.edu'>jmh579@cornell.edu</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://magrittr.tidyverse.org'>magrittr</a></span><span class='op'>)</span>
<span class='va'>ikeogu.2017</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>study.name</span> <span class='op'>==</span> <span class='st'>"C16Mcal"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>reference <span class='op'>=</span> <span class='va'>DMC.oven</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>sample.id</span>, <span class='va'>reference</span>, <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"X"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>TrainSpectralModel</span><span class='op'>(</span>df <span class='op'>=</span> <span class='va'>.</span>,
                     tune.length <span class='op'>=</span> <span class='fl'>3</span>,
                     num.iterations <span class='op'>=</span> <span class='fl'>3</span>,
                     output.summary <span class='op'>=</span> <span class='cn'>TRUE</span>,
                     return.model <span class='op'>=</span> <span class='cn'>FALSE</span>,
                     best.model.metric <span class='op'>=</span> <span class='st'>"RMSE"</span>,
                     stratified.sampling <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   Summary_type     RMSEp        R2p       RPD     RPIQ        CCC        Bias
#&gt; 1         mean 2.4952870 0.66046187 1.7002476 2.272828 0.77607229 -0.05108303
#&gt; 2           sd 0.1782122 0.09701315 0.2041364 0.132022 0.08128926  0.58338017
#&gt;         SEP     RMSEcv      R2cv       R2sp best.ncomp
#&gt; 1 2.5306829 1.88501136 0.8046088 0.63251996          3
#&gt; 2 0.1807402 0.07138066 0.0367059 0.04195468         NA</div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jenna Hershberger, NSF BREAD IOS-1543958.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


