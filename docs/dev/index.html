<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vis-NIR Spectral Analysis Wrapper • waves</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/solar/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Vis-NIR Spectral Analysis Wrapper">
<meta property="og:description" content="Originally designed application in the context of resource-limited plant research 
    and breeding programs, waves provides an open-source solution to spectral data processing 
    and model development by bringing useful packages together into a streamlined pipeline. 
    This package is wrapper for functions related to the analysis of point visible and 
    near-infrared reflectance measurements. It includes visualization, filtering, aggregation, 
    preprocessing, cross-validation set formation, model training, and prediction functions to 
    enable open-source association of spectral and reference data. This package is documented 
    in a peer-reviewed manuscript in the Plant Phenome Journal &lt;doi:10.1002/ppj2.20012&gt;.
    Specialized cross-validation schemes are described in detail in Jarquín et al. (2017) 
    &lt;doi:10.3835/plantgenome2016.12.0130&gt;. Example data is from Ikeogu et al. (2017) 
    &lt;doi:10.1371/journal.pone.0188918&gt;.">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">waves</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GoreLab/waves/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="waves" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#waves" class="anchor"></a>waves</h1></div>
<!-- badges: start -->

<p>Originally designed application in the context of resource-limited plant research and breeding programs, <code>waves</code> provides an open-source solution to spectral data processing and model development by bringing useful packages together into a streamlined pipeline. This package is wrapper for functions related to the analysis of point visible and near-infrared reflectance measurements. It includes visualization, filtering, aggregation, preprocessing, cross-validation set formation, model training, and prediction functions to enable open-source association of spectral and reference data.</p>
<div id="cite" class="section level2">
<h2 class="hasAnchor">
<a href="#cite" class="anchor"></a>Cite</h2>
<p>This package is documented in a peer-reviewed manuscript in the Plant Phenome Journal. Please cite the manuscript if you have found this package to be useful!</p>
<blockquote>
<p>Hershberger, J, Morales, N, Simoes, CC, Ellerbrock, B, Bauchet, G, Mueller, LA, Gore MA. Making waves in Breedbase: An integrated spectral data storage and analysis pipeline for plant breeding programs. Plant Phenome J. 2021; 4:e20012. <a href="https://doi.org/10.1002/ppj2.20012" class="uri">https://doi.org/10.1002/ppj2.20012</a></p>
</blockquote>
</div>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Use</h2>
<p>Follow the installation instructions below, and then go wild! Use <code>waves</code> to analyze your own data. Please report any bugs or feature requests by opening issues in this repository.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install the latest <code>waves</code> release directly from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"waves"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, install the development version to get the most up-to-date (but not necessarily thoroughly tested) version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"GoreLab/waves"</span><span class="op">)</span></code></pre></div>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<div id="1-format-your-data-match-spectra-with-reference-values-so-that-you-have-a-dataframe-with-unique-identifiers-reference-values-and-other-metadata-as-columns-to-the-left-of-spectral-values-spectral-column-names-should-start-with-x" class="section level3">
<h3 class="hasAnchor">
<a href="#1-format-your-data-match-spectra-with-reference-values-so-that-you-have-a-dataframe-with-unique-identifiers-reference-values-and-other-metadata-as-columns-to-the-left-of-spectral-values-spectral-column-names-should-start-with-x" class="anchor"></a>1. Format your data. Match spectra with reference values so that you have a dataframe with unique identifiers, reference values, and other metadata as columns to the left of spectral values. Spectral column names should start with “X”.</h3>
<p><img src="reference/figures/formatted_data.png" alt="Example Format"></p>
</div>
<div id="2-visualize-and-filter-spectra-using-plotspectra-and-filterspectra" class="section level3">
<h3 class="hasAnchor">
<a href="#2-visualize-and-filter-spectra-using-plotspectra-and-filterspectra" class="anchor"></a>2. Visualize and filter spectra using <code>PlotSpectra()</code> and <code>FilterSpectra()</code>.</h3>
<p><img src="reference/figures/filter_data.png" alt="Filter data"></p>
</div>
<div id="3-if-you-have-more-than-one-scan-per-unique-identifier-aggregate-the-scans-by-mean-or-median-with-aggregatespectra" class="section level3">
<h3 class="hasAnchor">
<a href="#3-if-you-have-more-than-one-scan-per-unique-identifier-aggregate-the-scans-by-mean-or-median-with-aggregatespectra" class="anchor"></a>3. If you have more than one scan per unique identifier, aggregate the scans by mean or median with <code>AggregateSpectra()</code>.</h3>
<p><img src="reference/figures/aggregate.png" alt="Aggregate"></p>
</div>
<div id="4-use-testmodelperformance-to-perform-preprocessing-cross-validation-set-formation-and-model-training-functions-over-multiple-iterations" class="section level3">
<h3 class="hasAnchor">
<a href="#4-use-testmodelperformance-to-perform-preprocessing-cross-validation-set-formation-and-model-training-functions-over-multiple-iterations" class="anchor"></a>4. Use <code>TestModelPerformance()</code> to perform preprocessing, cross-validation set formation, and model training functions over multiple iterations.</h3>
<div id="a-applies-any-of-12-combinations-of-spectral-preprocessing-methods-using-dopreprocessing" class="section level4">
<h4 class="hasAnchor">
<a href="#a-applies-any-of-12-combinations-of-spectral-preprocessing-methods-using-dopreprocessing" class="anchor"></a>a. Applies any of 12 combinations of spectral preprocessing methods using <code>DoPreprocessing()</code>.</h4>
<p><img src="reference/figures/preprocess.png" alt="Preprocess"></p>
</div>
<div id="b-determines-cross-validation-scheme-with-formatcv-choose-from-random-stratified-random-or-a-plant-breeding-specific-scheme-from-jarquín-et-al-2017-the-plant-genome" class="section level4">
<h4 class="hasAnchor">
<a href="#b-determines-cross-validation-scheme-with-formatcv-choose-from-random-stratified-random-or-a-plant-breeding-specific-scheme-from-jarqu%C3%ADn-et-al-2017-the-plant-genome" class="anchor"></a>b. Determines cross-validation scheme with <code>FormatCV()</code>. Choose from random, stratified random, or a plant breeding-specific scheme from <a href="https://doi.org/10.3835/plantgenome2016.12.0130">Jarquín et <em>al.</em>, 2017. <em>The Plant Genome</em></a>.</h4>
<p><img src="reference/figures/cv_schemes.png" alt="CV"></p>
</div>
<div id="c-trains-spectral-prediction-models-using-trainspectralmodel" class="section level4">
<h4 class="hasAnchor">
<a href="#c-trains-spectral-prediction-models-using-trainspectralmodel" class="anchor"></a>c. Trains spectral prediction models using <code>TrainSpectralModel()</code>.</h4>
<ul>
<li>Choose from partial least squares regression, random forest, and support vector machine algorithms</li>
<li>Uses 5-fold cross validation within the training set to tune model hyperparameters</li>
<li>Outputs model performance statistics (RMSE, R<sup>2</sup>, Bias, etc.) as assessed with test set</li>
</ul>
</div>
</div>
<div id="5-save-trained-prediction-models-with-savemodel" class="section level3">
<h3 class="hasAnchor">
<a href="#5-save-trained-prediction-models-with-savemodel" class="anchor"></a>5. Save trained prediction models with <code>SaveModel()</code>.</h3>
<ul>
<li>Intended for a production environment</li>
<li>Can evaluate preprocessing methods using the input dataset</li>
<li>Selects best model using the metric provided (RMSE or R<sup>2</sup>)</li>
<li>Returns trained model with option to save as .Rds object</li>
</ul>
</div>
<div id="6-predict-phenotypic-values-with-new-spectra-and-a-saved-model-using-predictfromsavedmodel" class="section level3">
<h3 class="hasAnchor">
<a href="#6-predict-phenotypic-values-with-new-spectra-and-a-saved-model-using-predictfromsavedmodel" class="anchor"></a>6. Predict phenotypic values with new spectra and a saved model using <code>PredictFromSavedModel()</code>.</h3>
</div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>The package comes with an example dataset from <a href="https://doi.org/10.1371/journal.pone.0188918">Ikeogu et <em>al.</em> (2017) <em>PLoS ONE</em></a> that can be used to try out package capabilities:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load and preview the example dataset (ikeogu.2017)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ikeogu.2017</span><span class="op">)</span>
<span class="va">ikeogu.2017</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>

<span class="co"># Inspect and show the number of observations for each study within the `data.frame`</span>
<span class="va">ikeogu.2017</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">study.name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>n.obs <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
<span class="co"># Plot reference value distributions</span>
<span class="va">ikeogu.2017</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">study.name</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span><span class="va">trait</span>, <span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">DMC.oven</span><span class="op">:</span><span class="va">TCC</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span> <span class="va">study.name</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">study.name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">trait</span>, scales<span class="op">=</span><span class="st">'free_y'</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="example-dataset-reference-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#example-dataset-reference-distributions" class="anchor"></a>Example dataset reference distributions:</h3>
<p><img src="reference/figures/example_ref_dists_h.png" alt="Reference distributions"></p>
<p>A. Root dry matter content as measured by the oven method for the four studies included in the example dataset</p>
<p>B. Total carotenoid content as measured by HPLC</p>
</div>
</div>
<div id="performance-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#performance-tests" class="anchor"></a>Performance tests</h2>
<pre class="{r}"><code># Subset two of the studies from the dataset in preparation for model building
C16Mcal &lt;- ikeogu.2017 %&gt;% filter(study.name == "C16Mcal") %&gt;% 
  rename(reference = DMC.oven) %&gt;%
  rename(unique.id = sample.id) %&gt;%
  dplyr::select(unique.id, reference, starts_with("X")) %&gt;% 
  na.omit()
C16Mval &lt;- ikeogu.2017 %&gt;% filter(study.name == "C16Mval") %&gt;% 
  rename(reference = DMC.oven) %&gt;%
  rename(unique.id = sample.id) %&gt;%
  dplyr::select(unique.id, reference, starts_with("X")) %&gt;% 
  na.omit()
  
# Then try out `TestModelPerformance()` to predict reference values from spectra
test_results &lt;- TestModelPerformance(train.data = C16Mcal, 
                                     test.data = C16Mval,
                                     num.iterations = 10, 
                                     preprocessing = T, 
                                     summary = F,
                                     wavelengths = 350:2500)</code></pre>
<div id="waves-prediction-model-performance" class="section level3">
<h3 class="hasAnchor">
<a href="#waves-prediction-model-performance" class="anchor"></a><code>waves</code> prediction model performance</h3>
<p><img src="reference/figures/testplot_all_R2.png" alt="Pretreatment performance with example data"></p>
<p>Distributions of R<sub>p</sub><sup>2</sup>, the squared Pearson’s correlation between predicted and observed for the test set, for partial least squares regression (PLSR) models of two root quality traits trained on samples from the C16Mcal dataset and tested on samples from the C16Mval dataset from <a href="https://doi.org/10.1371/journal.pone.0188918">Ikeogu et <em>al.</em> (2017) <em>PLoS ONE</em></a> with raw data or after pretreatment.</p>
<p>*SNV: standard normal variate, SNV1D: standard normal variate and first derivative, SNV2D: standard normal variate and second derivative, D1: first derivative, D2: second derivative, SG: Savitzky-Golay with window size = 11, SNVSG: standard normal variate and Savitzky-Golay, SGD1: gap segment derivative with window size = 11, SG.D1W5: Savitzky-Golay with window size = 5 and first derivative, SG.D1W11: Savitzky-Golay with window size = 11 and first derivative, SG.D2W5: Savitzky-Golay with window size = 5 and second derivative, SG.D2W11: Savitzky-Golay with window size = 11 and second derivative.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=waves">https://​cloud.r-project.org/​package=waves</a>
</li>
<li>Browse source code at <br><a href="https://github.com/GoreLab/waves/">https://​github.com/​GoreLab/​waves/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/GoreLab/waves/issues%20">https://​github.com/​GoreLab/​waves/​issues </a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing waves</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://jmh579.github.io">Jenna Hershberger</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3147-6867" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>NSF BREAD IOS-1543958 <br><small class="roles"> Funder </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/GoreLab/waves/actions"><img src="https://github.com/GoreLab/waves/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://jmh579.github.io">Jenna Hershberger</a>, NSF BREAD IOS-1543958.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
